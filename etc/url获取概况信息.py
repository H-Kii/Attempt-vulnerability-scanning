import json
import socket
from whois import whois
import re


def url_ip(url):   #socket,返回url对应的ip
    try:
        agex = "\d+\.\d+\.\d+\.\d+"
        ip_dir = re.findall(agex,url,re.I)[0]
        # print(ip_dir)
        return ip_dir
    except:
        regular = "(?<=//).*"
        file = re.findall(regular, url, re.I)[0]
        # print(file)
        ip = socket.getaddrinfo(file,"http")[0][4][0]
        # print(ip)
        return ip

def url_message(url):   #url域名的站点信息收集，以dict形式返回
    res=whois(url)
    res=str(res)
    resp = json.loads(res)
    # print(resp)
    return resp


def url_read_write():
    with open('../opt/前端传url.txt','r') as file:
        url = file.readline()
        ip = url_ip(url)
        message = url_message(url)
    with open('../opt/IP.txt','w') as fil:
        fil.write(ip)
    with open('../opt/概况信息结果.json','w') as fi:
        json.dump(message,fi)
        return True

# url_read_write()