import requests
import base64
import re

# domain="woniuxy.com"
def url_back():
    my_email = "自己的邮箱"   
    my_key = "自己的key"  
    with open('../opt/前端传url.txt','r') as file:   #读取前端传来的url,借助fofa的api
        read = file.readline().strip()
    regular = "(?<=//).*"
    file = re.findall(regular, read, re.I)[0]
    staten = f'domain="{file}"'    #拼接一下
    base = base64.b64encode(staten.encode()).decode()   
    api = f'https://fofa.info/api/v1/search/all?email={my_email}&key={my_key}&qbase64={base}'     #可以设置获取多少个信息，使用size
    # print(api)
    resullt = requests.get(api)
    res = resullt.json()['results']
    # print(res)
    with open('../opt/子域名结果.txt','w') as file:
        for r in res:
            file.write (str(r).strip('[').strip(']')+'\n')
        return True
    
# url_back()
