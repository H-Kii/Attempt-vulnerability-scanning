from functools import partial
import json
import requests


class post_cve:
    def __init__(self):   #读取指定文件
        with open('../opt/前端传url.txt','r') as file:
            self.url = file.readline()
    def jude_payloads(self,path):
        with open(path,'r') as file:
            self.payload = json.load(file)
        for pay in self.payload.values():
            if pay['request'] == 'post':
                try:
                    # print(pay['payload'])
                    # proxies = {
                    #     "http": 'http://127.0.0.1:8080',
                    #     "https": 'http://127.0.0.1:8080'
                    # }
                    # requests_request = partial(requests.request, proxies=proxies, verify=False, allow_redirects=False)
                    response = requests.post(url=self.url,data=pay['payload'])
                    code = response.status_code
                    res = response.text
                    # print(res)
                    if code == pay['reply']:
                        a = f"存在{pay['number']}漏洞"
                        # print(a)
                        return a
                    if pay['reply'] in res:
                        a = f"存在{pay['number']}漏洞"
                        # print(a)
                        return a
                except:
                    pass

post_cve = post_cve()
def post(path):
    a = post_cve.jude_payloads(path)
    return a