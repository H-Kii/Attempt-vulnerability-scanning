import json
import requests


class post_cve:
    def __init__(self):   #读取指定文件
        with open('../opt/前端传url.txt','r') as file:
            self.url = file.readline()
        with open('../cve/cvepayload.json','r') as file:
            self.payload = json.load(file)

    def jude_payloads(self):
        for pay in self.payload.values():
            if pay['request'] == 'post':
                # print(pay['payload'])
                response = requests.post(url=self.url,data=pay['payload'])
                code = response.status_code
                res = response.text
                if code == pay['reply']:
                    a = f"存在{pay['number']}漏洞"
                    print(a)
                    return a
                if pay['reply'] in res:
                    a = f"存在{pay['number']}漏洞"
                    print(a)
                    return a

post_cve = post_cve()
def post():
    a = post_cve.jude_payloads()
    return a

